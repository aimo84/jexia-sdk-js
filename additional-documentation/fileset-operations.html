<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Jexia Javascript SDK</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/material.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">Jexia Javascript SDK</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content additional-page">
                   <div class="content-data">














                   




<h1 id="jexia-fileset-module-jfs">Jexia Fileset Module (JFS)</h1>
<p>JFS is used for uploading, fetching and manipulating files as any other user data. Basically, fileset is a dataset, 
but provides a way to maintain large data objects (files).<br>Before uploading any file you need to manually create a fileset with
<a href="https://www.jexia.com/en/docs/filesets/">Web Management Application</a>.
You can also set AWS bucket and credentials so that your files will be automatically uploaded to your Amazon storage.</p>
<h3 id="initialize"><a href="#init">Initialize</a></h3>
<p>To use fileset features, just add <code>fileOperations</code> module to the client initialization. Notice, that for Node.js
you have to import fileOperations from <code>jexia-sdk-js/node</code>, but if you running your application in browser you need to
use <code>jexia-sdk-js/browser</code> path. It&#39;s because file format is different under these two platforms.</p>
<div><pre class="line-numbers"><code class="language-typescript">import { jexiaClient, fileOperations } from &quot;jexia-sdk-js/node&quot;; // &quot;jexia-sdk-js/browser&quot; for browser applications

const jfs = fileOperations();

jexiaClient().init({
  projectID: &quot;your-project-id&quot;,  
  key: &quot;your-api-key&quot;,  
  secret: &quot;your-api-secret&quot;  
}, jfs);</code></pre></div><h3 id="configure-module"><a href="#configure">Configure module</a></h3>
<p>You can pass a config object to the <code>fileOperation()</code> function:</p>
<div><pre class="line-numbers"><code class="language-typescript">const jfs = fileOperations({
  /* Use RTC module to subscribe for the fileset events and wait until file
     will be successfully uploaded. Needs RTC module to be activated
     default: false */
  uploadWaitForCompleted: boolean,
  /* Timeout for uploading files
     default: 120000 */
  uploadTimeout: number
});</code></pre></div><h3 id="files-format"><a href="#format">Files format</a></h3>
<p>Under Node.js <code>jfs</code> accepts <a href="#https://nodejs.org/dist/latest-v10.x/docs/api/fs.html#fs_class_fs_readstream">read stream</a>, 
which can be created with <code>fs.createReadStream(path)</code>. </p>
<div><pre class="line-numbers"><code class="language-js">const fs = require(&quot;fs&quot;);
const record = {
  file: fs.createReadStream(&quot;../assets/logo.png&quot;)
}</code></pre></div><p>In browser you need to pass <strong>Blob</strong> returned by <code>&lt;input type=&quot;file&quot;&gt;</code> (part of HTML5 File Api).</p>
<div><pre class="line-numbers"><code class="language-js">const fileInput = document.getElementById(&quot;file-input&quot;);
fileInput.addEventListener(&quot;change&quot;, event =&gt; {
  const record = {
    file: event.target.files[0]
  }
}</code></pre></div><h3 id="custom-fileset-fields"><a href="#custom-fields">Custom fileset fields</a></h3>
<p>You can also send any additional fields alongside with a file and they will be stored in a fileset. 
Just use <code>data</code> property:</p>
<div><pre class="line-numbers"><code class="language-typescript">const record = {
  data: {
    description: &quot;Main company logo&quot;,
    useByDefault: true
  },
  file
}</code></pre></div><h3 id="upload-a-file-to-the-fileset"><a href="#upload">Upload a file to the fileset</a></h3>
<p>If you already set up a fileset, you are able to upload files. One or multiple files can be uploaded at once. <code>upload()</code> 
returns an observable and you need to call <code>subscribe()</code> to start uploading process. Each uploaded file will emit a 
<em>fileRecord</em>, which contains <em>id</em> and <em>status</em>. of uploaded file.</p>
<div><pre class="line-numbers"><code class="language-typescript">jfs.fileset(&quot;fileset_name&quot;).upload([
  record1, record2, ...
]).subscribe(fileRecord =&gt; {
   console.log(fileRecord);
   /* output:
   { id: &quot;11a12f17-8367-4114-a588-ae98a6cb3cda&quot;,
      created_at: &quot;2019-05-24T07:17:37.325882Z&quot;,
      updated_at: &quot;2019-05-24T07:17:37.325882Z&quot;,
      name: null,
      size: null,
      type: null,
      url: null,
      status: &quot;in_progress&quot; }
    */
});</code></pre></div><h3 id="file-upload-status"><a href="#status">File upload status</a></h3>
<p>After you upload a file you will receive file status. Status displays the progress of file uploading. 
Possible values are: </p>
<ul>
<li><p><code>in_progress</code> </p>
</li>
<li><p><code>completed</code></p>
</li>
<li><p><code>failed</code> </p>
<p>The first status you will get in response from <code>upload()</code> is <code>in_progress</code> (if you did not set true to the 
<code>subscribeForTheFileUploading</code> config property). It means that file record has been created and currently file is 
uploading to the persistent storage (whether AWS bucket or something else). 
There are two ways to track further file status changes:</p>
</li>
<li><p>subscribe to the fileset changes with <code>realTimeModule</code>. When your file is to be successfully uploaded 
you will get <code>completed</code> status (or <code>error</code> if something goes wrong).</p>
</li>
<li><p>set <code>uploadWaitForCompleted</code> config option and SDK will wait for the <code>completed</code> status automatically.</p>
</li>
</ul>
<p>Use <code>realTimeModule</code>:</p>
<div><pre class="line-numbers"><code class="language-typescript">import { jexiaClient, fileOperations, realTime } from &quot;jexia-sdk-js/node&quot;;

const jfs = fileOperations();

jexiaClient().init({
  projectID: &quot;your-project-id&quot;,
  key: &quot;your-project-key&quot;,
  secret: &quot;your-project-secret&quot;
}, jfs, realTime());

const fileset = jfs.fileset(&quot;fileset_name&quot;);

const records = [{
  data: {
    description: &quot;just a file&quot;
  },
  file: fs.createReadStream(&quot;../assets/logo.png&quot;)
}];

fileset.upload(records).pipe(
  concatMap(fileRecord =&gt; fileset.watch().pipe(
    filter(event =&gt; event.data[0].id === fileRecord.id),
    takeWhile(event =&gt; event.data[0].status !== &quot;completed&quot;, true),
    map(event =&gt; {
      fileRecord.status = event.data[0].status;
      return fileRecord;
    })
  ))
).subscribe();</code></pre></div><p>As you can see, there are some details you should take care of: filtering events by record id (<code>watch()</code> returns 
all events from the fileset), unsubscribing from watch observable with <code>takeWhile</code>. Better to use the next option.</p>
<p>Use <code>uploadWaitForCompleted</code> config property (notice that you still need to activate realTimeModule):</p>
<div><pre class="line-numbers"><code class="language-typescript">import { jexiaClient, fileOperations, realTime } from &quot;jexia-sdk-js/node&quot;;
import * as fs from &quot;fs&quot;;

const jfs = fileOperations({
  uploadWaitForCompleted: true    
});

jexiaClient().init({
  projectID: &quot;your-project-id&quot;,
  key: &quot;your-project-key&quot;,
  secret: &quot;your-project-secret&quot;
}, jfs, realTime());

const fileset = jfs.fileset(&quot;fileset_name&quot;);

const records = [{
  data: {
    description: &quot;just a file&quot;
  },
  file: fs.createReadStream(&quot;../assets/logo.png&quot;)
}];

fileset.upload(records).subscribe(fileRecord =&gt; {
  console.log(fileRecord);
  /* output:
    { id: &quot;11a12f17-8367-4114-a588-ae98a6cb3cda&quot;,
      created_at: &quot;2019-05-24T07:17:37.325882Z&quot;,
      updated_at: &quot;2019-05-24T07:18:40.455764Z&quot;,
      name: &quot;logo.png&quot;,
      size: 42341,
      type: &quot;png&quot;,
      url: &quot;https://...&quot;,
      status: &quot;completed&quot; }
  */
});</code></pre></div><h3 id="fileset-crud-operations"><a href="#crud">Fileset CRUD operations</a></h3>
<p>It&#39;s possible to query filesets in the same way as datasets, except insert query - you need to use <code>upload()</code> instead.<br>All fileset records are basically FileRecords, they have additional fields, such as <code>name</code>, <code>size</code>, <code>url</code>, etc.<br>These fields, as well as any custom fields, can be used for select queries (but you cannot update them).  </p>
<h4 id="select-query">Select query</h4>
<div><pre class="line-numbers"><code class="language-typescript">jfs.fileset(&quot;fileset_name&quot;)  
 .select(&quot;name&quot;, &quot;url&quot;)  
 .where(field =&gt; field(&quot;size&quot;).isGreaterThan(1024000))  
 .subscribe();  

// array of files that fit to the condition will be returned  
// files === [{ name: &quot;file1.jpj&quot;, url: &quot;https://...&quot; }, {...}, ...]  </code></pre></div><h4 id="update-query">Update query</h4>
<p>Update fileset in the same way as dataset. Updating a fileset record with new file is not supported.</p>
<div><pre class="line-numbers"><code class="language-typescript">jfs.fileset(&quot;fileset_name&quot;)  
 .update({ &quot;isDefaultImage&quot;: false })  
 .where(field =&gt; field(&quot;name&quot;).isEqualTo(&quot;companyLogo.png&quot;))
 .subscribe();  </code></pre></div><h4 id="delete-query">Delete query</h4>
<div><pre class="line-numbers"><code class="language-typescript">jfs.fileset(&quot;fileset_name&quot;)  
 .delete()  
 .where(field =&gt; field(&quot;size&quot;).isGreaterThan(1024000))  
 .subscribe();  </code></pre></div>
                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'additional-page';
            var COMPODOC_CURRENT_PAGE_URL = 'fileset-operations.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
